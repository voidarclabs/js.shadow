<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="files.css">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://fonts.googleapis.com/css?family=Varela Round' rel='stylesheet'>
    <script src="https://kit.fontawesome.com/ea3f46344d.js" crossorigin="anonymous"></script>
    <title>Document</title>
</head>
<body>
    
    <div id="fileselect">
        <div id="topbar">
            <input type="file" onchange="upload(this.files)" />
        </div>
        <div id="fileList"></div>
    </div>
    <script>
        var socket = io()
        socket.on('connect', (data) => {
            console.log(data)
            socket.emit('files')
        })
        socket.on('filelist', (data) => {
            console.log(data)
            for (let i = 0; i < data.length; i++){
                file = data[i]
                fileHtml = ` <div class='file' id='file-${file}'>
                        <div onclick="select('${file}')" id="selecter"><i id='selectmark${file}' class=" fa-regular fa-circle-check"></i></div>
                        <a id='filelink' href='/files/${file}' download>${file}</a>
                        <div class='filemenuoptions' id='filemenu${i}'>
                            <div onclick='delete(${file})' id="delete"><i class="fa-solid fa-trash"></i></div>
                            
                        </div>
                    </div>`
                document.getElementById('fileList').innerHTML += fileHtml
            };
        })

var selected = []

function select(file) {
    const selectfile = document.getElementById(`selectmark${file}`)
    const filecontainer = document.getElementById(`file-${file}`)
    const index = selected.indexOf(file);
        if (index > -1) { // only splice array when item is found
            selected.splice(index, 1); // 2nd parameter means remove one item only
            selectfile.classList.remove('fa-solid')
            selectfile.classList.add('fa-regular')
            filecontainer.classList.remove('fileselected')
        } else {
            selected.push(file)
            selectfile.classList.remove('fa-regular')
            selectfile.classList.add('fa-solid')
            filecontainer.classList.add('fileselected')
        }
}

function deletefile(file) {
    socket.emit('delete', file)
}
function upload(files) {
        var filename = getFileData() //what is even this
        socket.emit("upload", files[0], (status) => {
          console.log(status);
        });
      }

function getFileData(myFile){ //make this work somehow pls
   var file = myFile.files[0];  
   var filename = file.name;
   return filename
}
const menuelements = []

    </script>
</body>
</html>